name: Build and Publish Docker Image (Bug Fix Branch)

on:
  push:
    branches: [ fix/habits-activity-typeerror-bugs ]
  workflow_dispatch:

jobs:
  # Build docker image and publish it to GitHub Container Registry
  docker-bugfix:
    name: Publish bugfix branch to GitHub registry
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          ref: fix/habits-activity-typeerror-bugs

      - name: Login to GitHub Container Registry
        run: echo ${{ github.token }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin

      - name: Build docker image
        run: docker build -t ghcr.io/${{ github.repository_owner }}/metrics:bugfix-habits-activity .

      - name: Publish to GitHub Container Registry
        run: docker push ghcr.io/${{ github.repository_owner }}/metrics:bugfix-habits-activity

      - name: Tag as branch name
        run: |
          docker tag ghcr.io/${{ github.repository_owner }}/metrics:bugfix-habits-activity ghcr.io/${{ github.repository_owner }}/metrics:fix-habits-activity-typeerror-bugs
          docker push ghcr.io/${{ github.repository_owner }}/metrics:fix-habits-activity-typeerror-bugs

      - name: Summary
        run: |
          echo "âœ… Docker image published successfully!"
          echo ""
          echo "**Image tags:**"
          echo "- \`ghcr.io/${{ github.repository_owner }}/metrics:bugfix-habits-activity\`"
          echo "- \`ghcr.io/${{ github.repository_owner }}/metrics:fix-habits-activity-typeerror-bugs\`"
          echo ""
          echo "**Usage in GitHub Actions:**"
          echo "\`\`\`yaml"
          echo "uses: docker://ghcr.io/${{ github.repository_owner }}/metrics:bugfix-habits-activity"
          echo "\`\`\`"
